generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id                          String   @id @default(cuid())

  // Company Information
  companyName                 String?  // Company name
  companyType                 String?  // Type of company
  abbreviation                String?  // Abbreviation
  legalId                     String?  // Legal ID (Cédula Jurídica)
  shareCapital                String?  // Share capital
  numberOfShares              String?  // Number of shares
  shareValue                  String?  // Share value
  series                      String?  // Series
  registeredAddress           String?  // Registered address
  companyTerm                 Int?     // Company term (years)
  incorporationDate           String?  // Incorporation date

  // Shareholder 1
  shareholderOne              String?  // Shareholder one
  certificateNumber           Int?     // Certificate number
  identification              String?  // Identification
  ownership                   String?  // Ownership
  numberOfSharesHeld          Int?     // Number of shares
  date                        Int?     // Date
  month                       String?  // Month
  year                        Int?     // Year
  print                       String?  // Print
  excelId                     Int?     // Id (from Excel)
  capitalNumber               String?  // Capital number
  maritalStatus               String?  // Marital status
  profession                  String?  // Profession
  shareholder1Address         String?  // Shareholder 1 address
  reference                   String?  // Reference
  sharesInWords1              String?  // Shares in words
  percentage1                 String?  // Percentage

  // Shareholder 2
  certificateNumber2          Int?     // Certificate number 2
  reference2                  String?  // Reference 2
  shareholder2Address         String?  // Shareholder 2 address
  profession2                 String?  // Profession 2
  maritalStatus2              String?  // Marital status 2
  shareholderTwo              String?  // Shareholder 2
  identification2             String?  // Identification 2
  ownership2                  String?  // Ownership 2
  percentage2                 String?  // Percentage 2
  sharesInNumbers2            String?  // Shares in numbers 2
  numberOfSharesHeld2         Int?     // Number of shares 2

  // Additional Fields
  field1                      Int?     // Field 1
  legalIdInWords              String?  // Legal ID in words
  renewalStartDate            String?  // Renewal start date
  active                      Int?     // Active
  archived                    Int?     // Archived
  cooperator                  String?  // Cooperator
  legalRepresentative         String?  // Legal representative
  representativeId            String?  // Representative ID
  activeTaxation              Int?     // Active taxation

  // Manager 1
  managerFirstName            String?  // Manager 1 first name
  managerId                   String?  // Manager 1 ID
  managerAddress              String?  // Manager 1 address
  managerOccupation           String?  // Manager 1 occupation
  managerMaritalStatus        String?  // Manager 1 marital status
  managerNationality          String?  // Manager 1 nationality
  managerLastName             String?  // Manager 1 last name

  // Manager 2
  manager2FirstName           String?  // Manager 2 first name
  manager2LastName            String?  // Manager 2 last name
  manager2Id                  String?  // Manager 2 ID
  manager2Address             String?  // Manager 2 address
  manager2Occupation          String?  // Manager 2 occupation
  manager2MaritalStatus       String?  // Manager 2 marital status
  manager2Nationality         String?  // Manager 2 nationality

  // Sub-manager
  subManagerFirstName         String?  // Sub-manager first name
  subManagerLastName          String?  // Sub-manager last name
  subManagerId                String?  // Sub-manager ID
  subManagerAddress           String?  // Sub-manager address
  subManagerOccupation        String?  // Sub-manager occupation
  subManagerMaritalStatus     String?  // Sub-manager marital status
  subManagerNationality       String?  // Sub-manager nationality

  // Other
  denomination                String?  // Denomination
  idInNumbers                 String?  // ID in numbers
  dissolvedRecord             Int?     // Dissolved record
  bookLegalization            String?  // Book legalization
  email                       String?  // Email
  tradeName                   String?  // Trade name

  // Timestamps
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  // Relations
  documents                   GeneratedDocument[]

  @@index([legalId])
  @@index([companyName])
  @@index([createdAt])
}

model DocumentTemplate {
  id              String   @id @default(cuid())
  name            String
  description     String?

  // Template content stored as JSON with placeholders
  // e.g., "Dear {{firstName}} {{lastName}}"
  content         String   @db.Text

  // Category for organization
  category        String?

  // Field mappings - which customer fields to use
  fieldMappings   String   @db.Text // JSON array of field names

  // Status
  isActive        Boolean  @default(true)

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  documents       GeneratedDocument[]
}

model GeneratedDocument {
  id              String   @id @default(cuid())

  // Reference to customer and template
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  templateId      String
  template        DocumentTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  // Document details
  fileName        String
  fileType        String   // "docx" or "xlsx"

  // Generated content (for audit/history)
  generatedData   String   @db.Text // JSON snapshot of data used

  // Timestamps
  createdAt       DateTime @default(now())

  @@index([customerId])
  @@index([templateId])
  @@index([createdAt])
}

model ExportHistory {
  id              String   @id @default(cuid())

  // Export details
  exportType      String   // "excel" or "word"
  fileName        String
  recordCount     Int

  // Filter criteria used (for reference)
  filterCriteria  String?  @db.Text // JSON

  // Timestamps
  createdAt       DateTime @default(now())
}

model User {
  id              String   @id @default(cuid())
  email           String   @unique
  password        String   // hashed password
  whatsappNumber  String   @default("") // required for new users, default for migration

  // Status
  isActive        Boolean  @default(true)

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([email])
}
