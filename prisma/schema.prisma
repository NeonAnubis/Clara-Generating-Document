generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id                          String   @id @default(cuid())

  // Company Information
  nombreDeLaSociedad          String?  // NOMBRE DE LA SOCIEDAD
  tipoDeSociedad              String?  // TIPO DE SOCIEDAD
  abreviatura                 String?  // ABREVIATURA
  cedulaJuridica              String?  // CÉDULA JURÍDICA
  capitalSocial               String?  // CAPITAL SOCIAL
  cantidadCuotas              String?  // CANTIDAD CUOTAS
  valorDeCuotas               String?  // VALOR DE CUOTAS
  serie                       String?  // SERIE
  domicilio                   String?  // DOMICILIO
  plazoSocial                 Int?     // PLAZO SOCIAL
  fechaDeConstitucion         String?  // FECHA DE CONSTITUCIÓN

  // Cuotista 1
  cuotistaUno                 String?  // CUOTISTA UNO
  numeroDeCertificado         Int?     // NUMERO DE CERTIFICADO
  identificacion              String?  // IDENTIFICACIÓN
  propiedad                   String?  // PROPIEDAD
  numeroDeCuotas              Int?     // NUMERO DE CUOTAS
  fecha                       Int?     // FECHA
  mes                         String?  // MES
  ano                         Int?     // AÑO
  imprimir                    String?  // IMPRIMIR
  excelId                     Int?     // Id (from Excel)
  capitalNumero               String?  // CAPITAL NÚMERO
  estadoCivil                 String?  // ESTADO CIVIL
  profesion                   String?  // PROFESION
  domicilioCuotista1          String?  // DOMICILIO CUOTISTA1
  referencia                  String?  // REFERENCIA
  enLetrasCuotas1             String?  // EN LETRAS CUOTAS1
  porcentaje1                 String?  // PORCENTAJE1

  // Cuotista 2
  numeroDeCertificado2        Int?     // NUMERO DE CERTIFICADO2
  referencia2                 String?  // REFERENCIA2
  domicilioCuotista2          String?  // DOMICILIO CUOTISTA2
  profesion2                  String?  // PROFESION2
  estadoCivil2                String?  // ESTADO CIVIL2
  cuotista2                   String?  // CUOTISTA 2
  identificacion2             String?  // IDENTIFICACION2
  propiedad2                  String?  // PROPIEDAD2
  porcentaje2                 String?  // PORCENTAJE2
  enNumerosCuotas2            String?  // EN NUMEROS CUOTAS2
  numeroDeCuotas2             Int?     // NUMERO DE CUOTAS2

  // Additional Fields
  campo1                      Int?     // Campo1
  cedulaLetras                String?  // CÉDULA LETRAS
  fechaInicioRenovacion       String?  // Fecha Inicio Renovación
  activa                      Int?     // Activa
  archivado                   Int?     // Archivado
  cooperador                  String?  // COOPERADOR
  representanteLegal          String?  // Represntante Legal
  identificacionRepresentante String?  // Identificación Representante
  tributacionActiva           Int?     // Tributación Activa

  // Gerente (Manager)
  nombreGerente               String?  // Nombre Gerente
  idGerente                   String?  // ID Gerente
  domicilioGerente            String?  // Domicilio Gerente
  ocupacionGerente            String?  // Ocupación Gerente
  estadoCivilGerente          String?  // Estado Civil Gerente
  nacionalidadGerente         String?  // Nacionalidad Gerente
  apellidoGerente             String?  // Apellido Gerente

  // Other
  denominacion                String?  // Denominación
  idEnNumeros                 String?  // ID en numeros
  disueltaRegistro            Int?     // Disuelta Registro
  legalizacionLibros          String?  // Legalizacion libros
  correoElectronico           String?  // Correo Electrónico
  nombreComercial             String?  // Nombre Comercial

  // Timestamps
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  // Relations
  documents                   GeneratedDocument[]

  @@index([cedulaJuridica])
  @@index([nombreDeLaSociedad])
  @@index([createdAt])
}

model DocumentTemplate {
  id              String   @id @default(cuid())
  name            String
  description     String?

  // Template content stored as JSON with placeholders
  // e.g., "Dear {{firstName}} {{lastName}}"
  content         String   @db.Text

  // Category for organization
  category        String?

  // Field mappings - which customer fields to use
  fieldMappings   String   @db.Text // JSON array of field names

  // Status
  isActive        Boolean  @default(true)

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  documents       GeneratedDocument[]
}

model GeneratedDocument {
  id              String   @id @default(cuid())

  // Reference to customer and template
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  templateId      String
  template        DocumentTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  // Document details
  fileName        String
  fileType        String   // "docx" or "xlsx"

  // Generated content (for audit/history)
  generatedData   String   @db.Text // JSON snapshot of data used

  // Timestamps
  createdAt       DateTime @default(now())

  @@index([customerId])
  @@index([templateId])
  @@index([createdAt])
}

model ExportHistory {
  id              String   @id @default(cuid())

  // Export details
  exportType      String   // "excel" or "word"
  fileName        String
  recordCount     Int

  // Filter criteria used (for reference)
  filterCriteria  String?  @db.Text // JSON

  // Timestamps
  createdAt       DateTime @default(now())
}

model User {
  id              String   @id @default(cuid())
  email           String   @unique
  password        String   // hashed password
  whatsappNumber  String   @default("") // required for new users, default for migration

  // Status
  isActive        Boolean  @default(true)

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([email])
}
